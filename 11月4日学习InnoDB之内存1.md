### 11月4日学习`InnoDB`之内存1 ###

1.  缓冲池

   由于`InnoDB`存储引擎存储是基于磁盘的，并将其中的记录按照页的方式进行管理，可以认为`InnoDB`是基于磁盘的数据库`Disk-base Database`,基于磁盘的数据库一般使用缓冲池技术来提高数据库的整体性能。

   缓冲池简单来说就是一块内存区域，通过内存的速度来弥补磁盘速度慢对数据库性能的影响。 __读取__ 页时，首先将页`"FIX"`到缓冲池中。下一次在读取相同的页时，首先判断该页是否在缓冲池中，在，则被命中，直接读取该页，否则，读取磁盘上的页。 __修改__ 页时，首先是修改缓冲池中的页，再以一定的频率刷新到磁盘上。然而，页从缓冲池刷新到磁盘上并不是每次页发生更改时触发，而是通`Checkpoint`机制刷新回磁盘。

2. 缓冲池的管理

   1. 数据库中的缓冲池是通过`LRU(Latest Recent Used)`算法来进行管理的，最频繁使用的页在`LRU`列表的前端，最少使用的在`LRU`列表的尾端，当缓冲池不能存放新读取到的页时，将首先释放`LRU`列表尾端的页。缓冲池的页同样使用`LRU`算法进行管理，但是`InnoDB`对传统的`LRU`算法进行了优化，加入了`midpoint`位置，新读取到的页不是直接放入`LRU`列表的首部，而是放到`midpoint`位置，默认`midpoint`为`LRU`列表长度的5/8处。`midpoint`之后的列表称为`old`列表，之前的称为`new`列表。

   2. 为什么不使用传统的`LRU`算法，直接将读取到的页放入`LRU`列表的首页呢？这是因为若直接将读取到的页放入到`LRU`列表的首部，那么某些`SQL`的操作可能使缓冲池中的页被强制刷新出，从而影响缓冲池的效率。常见的这种操作为索引或者数据的扫描操作。
   
   3. 为了解决2中的问题，`InnoDB`存储引擎引入了另一个参数来进一步管理`LRU`列表，这个参数就是`innodb_old_blocks_time`,用于表示读取到`mid`位置后需要等待多久后才会被加入到`LRU`列表的热端，因此需要进行上述所说的`SQL`操作时，可以通过如下语句来尽可能使`LRU`列表中的热点数据不会被刷出：
   
      ```mysql
      mysql> SET GLOBAL innodb_old_blocks_time=1000;
      ```
   
      

